(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-2aa69a1d"],{"0ec9":function(e,t,r){"use strict";r.r(t);var a=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{staticClass:"app-container"},[r("el-card",{staticClass:"operate-container",attrs:{shadow:"never"}},[r("div",{staticStyle:{"margin-bottom":"2%"}},[r("el-alert",{attrs:{title:"配置发布计划，如有配置，先发配置后发版本，暂只支持rancher环境。",type:"info"}})],1),r("div",{staticClass:"block"},[r("el-row",{staticClass:"row-bg",attrs:{type:"flex",justify:"end"}},[r("el-col",{attrs:{span:3}},[r("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:"项目",clearable:"",filterable:""},on:{change:function(t){return e.filterSelectTrigger()}},model:{value:e.listQuery.optionValue.project,callback:function(t){e.$set(e.listQuery.optionValue,"project",t)},expression:"listQuery.optionValue.project"}},e._l(e.projectFilterOptions,(function(e){return r("el-option",{key:e,attrs:{label:e,value:e}})})),1)],1),r("el-col",{attrs:{span:3}},[r("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:"状态",clearable:"",filterable:""},on:{change:function(t){return e.filterSelectTrigger()}},model:{value:e.listQuery.optionValue.status,callback:function(t){e.$set(e.listQuery.optionValue,"status",t)},expression:"listQuery.optionValue.status"}},e._l(e.statusOptions,(function(e){return r("el-option",{key:e,attrs:{label:e,value:e}})})),1)],1),r("el-col",{attrs:{span:3}},[r("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:"创建人",clearable:"",filterable:""},on:{change:function(t){return e.filterSelectTrigger()}},model:{value:e.listQuery.optionValue.owner,callback:function(t){e.$set(e.listQuery.optionValue,"owner",t)},expression:"listQuery.optionValue.owner"}},e._l(e.ownerOptions,(function(e){return r("el-option",{key:e,attrs:{label:e,value:e}})})),1)],1),r("el-col",{attrs:{span:6}},[r("div",{staticClass:"grid-content bg-purple"},[r("el-input",{staticStyle:{width:"250px"},attrs:{placeholder:"搜索"},on:{change:function(t){return e.search()}},model:{value:e.listQuery.search,callback:function(t){e.$set(e.listQuery,"search",t)},expression:"listQuery.search"}})],1)]),r("el-col",{attrs:{span:7}},[r("div",{staticClass:"grid-content bg-purple-light"})]),r("el-col",{attrs:{span:2}},[r("div",{staticClass:"grid-content bg-purple"},[r("el-button",{attrs:{type:"primary",icon:"el-icon-edit"},on:{click:function(t){return e.handleCreate()}}},[e._v("创建")])],1)])],1)],1)]),r("el-table",{staticStyle:{width:"100%"},attrs:{data:e.list,"header-cell-style":{background:"#eef1f6",color:"#606266"}}},[r("el-table-column",{attrs:{label:"发布名称",sortable:""},scopedSlots:e._u([{key:"default",fn:function(t){var a=t.row;return[r("span",{staticClass:"link-type",on:{click:function(t){return e.openDetail(a)}}},[e._v(e._s(a.name))])]}}])}),r("el-table-column",{attrs:{prop:"project",label:"项目"}}),r("el-table-column",{attrs:{prop:"category",label:"发布类型"}}),r("el-table-column",{attrs:{label:"创建时间",sortable:""},scopedSlots:e._u([{key:"default",fn:function(t){var r=t.row;return[e._v(" "+e._s(e._f("formatDate")(r.created_time))+" ")]}}])}),r("el-table-column",{attrs:{label:"计划发布时间",sortable:""},scopedSlots:e._u([{key:"default",fn:function(t){var r=t.row;return[e._v(" "+e._s(e._f("formatDate")(r.plan_release_time))+" ")]}}])}),r("el-table-column",{attrs:{label:"实际发布时间",sortable:""},scopedSlots:e._u([{key:"default",fn:function(t){var r=t.row;return[e._v(" "+e._s(e._f("formatDate")(r.release_time))+" ")]}}])}),r("el-table-column",{attrs:{label:"发布时长",sortable:""},scopedSlots:e._u([{key:"default",fn:function(t){var a=t.row;return[a.release_time?r("span",[e._v(e._s(e._f("duration")(a.release_time,a.last_updated_time)))]):e._e()]}}])}),r("el-table-column",{attrs:{prop:"owner",label:"创建人",sortable:""}}),r("el-table-column",{attrs:{label:"状态"},scopedSlots:e._u([{key:"default",fn:function(t){var a=t.row;return["发布成功"===a.status?r("el-tag",{attrs:{type:"success"}},[e._v(e._s(a.status))]):"发布失败"===a.status?r("el-tag",{attrs:{type:"danger"}},[e._v(e._s(a.status))]):r("el-tag",[e._v(e._s(a.status))])]}}])}),r("el-table-column",{attrs:{prop:"发布模块",label:"发布模块"},scopedSlots:e._u([{key:"default",fn:function(t){var a=t.row;return[r("span",{staticClass:"link-type",on:{click:function(t){return e.showJiraVersion(a.release_contents)}}},[e._v("版本详情")])]}}])}),r("el-table-column",{attrs:{label:"操作",width:"250px"},scopedSlots:e._u([{key:"default",fn:function(t){return[r("el-button",{attrs:{type:"success",size:"mini"},on:{click:function(r){return e.openDetail(t.row)}}},[e._v("发布入口 ")]),r("el-button",{attrs:{disabled:t.row.owner!==e.name||"发布成功"===t.row.status,type:"primary",size:"mini"},on:{click:function(r){return e.handleEdit(t.row)}}},[e._v("编辑 ")]),r("el-button",{attrs:{disabled:t.row.owner!==e.name||"未发布"!==t.row.status,type:"danger",size:"mini"},on:{click:function(r){return e.handleDelete(t.row)}}},[e._v("删除 ")])]}}])})],1),r("div",{staticClass:"pagination-container"},[r("el-pagination",{attrs:{align:"center","current-page":e.currentPage,"page-sizes":[10,15,20],"page-size":e.pageSize,layout:"total, sizes, prev, pager, next, jumper",total:e.total},on:{"size-change":e.handleSizeChange,"current-change":e.handleCurrentChange}})],1),r("el-dialog",{attrs:{title:"编辑发布计划",visible:e.dialogFormVisible,width:"32%","close-on-click-modal":!1},on:{"update:visible":function(t){e.dialogFormVisible=t}}},[r("el-form",{ref:"form",attrs:{model:e.form,rules:e.rules,"label-width":"110px"}},[r("el-form-item",{attrs:{label:"项目",prop:"project",required:""}},[r("el-select",{staticClass:"form-width",attrs:{clearable:"",filterable:""},model:{value:e.form.project,callback:function(t){e.$set(e.form,"project",t)},expression:"form.project"}},e._l(e.projectOptions,(function(e){return r("el-option",{key:e,attrs:{label:e,value:e}})})),1)],1),r("el-form-item",{attrs:{label:"发布名称",prop:"name",required:""}},[r("el-input",{staticClass:"form-width",model:{value:e.form.name,callback:function(t){e.$set(e.form,"name",t)},expression:"form.name"}})],1),r("el-form-item",{attrs:{label:"发布类型",required:""}},[r("el-radio-group",{model:{value:e.form.category,callback:function(t){e.$set(e.form,"category",t)},expression:"form.category"}},[r("el-radio",{attrs:{label:"正常发布"}},[e._v("正常发布")]),r("el-radio",{attrs:{label:"紧急发布"}},[e._v("紧急发布")])],1)],1),r("el-form-item",{attrs:{label:"计划发布时间",prop:"plan_release_time"}},[r("el-date-picker",{staticClass:"form-width",attrs:{type:"datetime",placeholder:"选择计划发布时间"},model:{value:e.form.plan_release_time,callback:function(t){e.$set(e.form,"plan_release_time",t)},expression:"form.plan_release_time"}})],1),r("el-form-item",{attrs:{label:"Jira单号",prop:"name"}},[r("el-select",{staticClass:"form-width",attrs:{filterable:"",clearable:"",placeholder:"请选择发布申请类型工单"},on:{change:function(t){return e.selectTrigger(e.form.issueKey)}},model:{value:e.form.issueKey,callback:function(t){e.$set(e.form,"issueKey",t)},expression:"form.issueKey"}},e._l(e.issueKeyOptions,(function(e){return r("el-option",{key:e,attrs:{label:e,value:e}})})),1),r("el-table-draggable",[r("el-table",{staticStyle:{width:"100%"},attrs:{data:e.form.selectList,"row-key":"index"}},[r("el-table-column",{attrs:{type:"index",label:"发布顺序",width:"100%"}}),r("el-table-column",{attrs:{label:"工单"},scopedSlots:e._u([{key:"default",fn:function(t){var a=t.row;return[r("el-link",{attrs:{href:"https://jira.datayes.com/browse/"+a.issue_key,type:"success",target:"_blank"}},[e._v(" "+e._s(a.issue_key)+" ")])]}}])}),r("el-table-column",{attrs:{prop:"release_version",label:"发布版本"}}),r("el-table-column",{attrs:{prop:"config_file",label:"配置文件"},scopedSlots:e._u([{key:"default",fn:function(t){var a=t.row;return["无"!==a.config_file&&a.config_file?r("el-popover",{attrs:{placement:"top-start",width:"300",trigger:"hover"}},[e._l(a.config_file.split("\r"),(function(t){return r("div",{staticClass:"text item"},[e._v(" "+e._s(t)+" ")])})),r("span",{staticStyle:{color:"#337ab7"},attrs:{slot:"reference"},slot:"reference"},[e._v("有")])],2):r("span",[e._v("无")])]}}])}),r("el-table-column",{attrs:{label:"操作",width:"50px"},scopedSlots:e._u([{key:"default",fn:function(t){return[r("el-button",{attrs:{type:"primary",size:"mini",icon:"el-icon-delete",circle:""},on:{click:function(r){return e.deleteIssueKey(t.$index,t.row)}}})]}}])})],1)],1)],1)],1),r("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[r("el-button",{on:{click:function(t){e.dialogFormVisible=!1}}},[e._v("取 消")]),e.dialogUpdateEnable?r("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.updateForm()}}},[e._v("确 定")]):r("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.submitForm()}}},[e._v("确 定")])],1)],1),r("el-dialog",{attrs:{title:"jira发布版本",visible:e.jiraVersionDialogFormVisible,width:"35%"},on:{"update:visible":function(t){e.jiraVersionDialogFormVisible=t}}},[r("el-table",{staticStyle:{width:"100%"},attrs:{data:e.jiraVersionList}},[r("el-table-column",{attrs:{prop:"index",label:"发布顺序",width:"80px"}}),r("el-table-column",{attrs:{label:"jira工单"},scopedSlots:e._u([{key:"default",fn:function(t){var a=t.row;return[r("el-link",{attrs:{href:"https://jira.datayes.com/browse/"+a.issue_key,type:"success",target:"_blank"}},[e._v(" "+e._s(a.issue_key)+" ")])]}}])}),r("el-table-column",{attrs:{prop:"release_version",label:"发布版本"}}),r("el-table-column",{attrs:{prop:"rancher_app_version",label:"rancher app 版本"}}),r("el-table-column",{attrs:{prop:"config_file",label:"配置文件"},scopedSlots:e._u([{key:"default",fn:function(t){var a=t.row;return[a.config_file?r("el-popover",{attrs:{placement:"top-start",width:"300",trigger:"hover"}},[e._l(a.config_file.split("\n"),(function(t){return r("div",{staticClass:"text item"},[e._v(" "+e._s(t)+" ")])})),r("span",{staticStyle:{color:"#337ab7"},attrs:{slot:"reference"},slot:"reference"},[e._v("有")])],2):r("span",[e._v("无")])]}}])})],1)],1)],1)},l=[],n=r("5530"),s=(r("d3b7"),r("6062"),r("3ca3"),r("ddb0"),r("ac1f"),r("841c"),r("498a"),r("159b"),r("caad"),r("b0c0"),r("a434"),r("c740"),r("5132")),i=r("8be9"),o=r("e4a4"),c=r.n(o),u=r("2f62"),f=r("c1df"),p={name:"Index",filters:{duration:function(e,t){var a=r("c1df"),l=a(t),n=a(e);return l.diff(n,"hours")+"h"+l.diff(n,"minutes")%60+"m"+l.diff(n,"seconds")%60+"s"}},components:{ElTableDraggable:c.a},data:function(){var e=this,t=function(t,r,a){var l=f(r).hours();l<16&&"正常发布"===e.form.category&&a(new Error("16点之前发布请选择紧急发布")),a()};return{optionValue:{},projectFilterOptions:new Set,statusOptions:new Set,ownerOptions:new Set,list:[],fullList:null,total:null,listLoading:!0,currentPage:1,pageSize:10,listQuery:{page:1,type:"rancher",search:null,optionValue:{status:"",owner:"",project:""}},form:{selectList:[],name:null,project:null,category:"正常发布",plan_release_time:null,config_file:null,issueKey:null},projectOptions:[],parentId:0,value1:null,num:5,dialogFormVisible:!1,dialogUpdateEnable:!1,issueKeyOptions:[],jiraVersionDialogFormVisible:!1,jiraVersionList:[],rules:{plan_release_time:[{required:!0,trigger:"blur"},{validator:t,trigger:"blur"}]}}},computed:Object(n["a"])({},Object(u["b"])(["name"])),created:function(){this.getList(),this.getReleasePlanOptions()},methods:{dateFormat:function(e,t){var r=e[t.property];return f(r).format("YYYY-MM-DD HH:mm:ss")},getList:function(){var e=this;this.listLoading=!0,Object(i["f"])(this.listQuery).then((function(t){e.listLoading=!1,e.list=t.data.results,e.total=t.data.count}))},getReleasePlanOptions:function(){var e=this;Object(i["d"])().then((function(t){var r=t.data;e.statusOptions=r.status,e.ownerOptions=r.owner,e.projectFilterOptions=r.project}))},filterSelectTrigger:function(){this.listQuery.page=1,this.getList()},search:function(){this.listQuery.search&&(this.listQuery.search=this.listQuery.search.trim()),this.getList()},selectTrigger:function(e){var t=this,r=[];this.form.selectList.forEach((function(e){r.push(e.issue_key)})),e&&!r.includes(e)&&Object(s["d"])({issue_key:e}).then((function(r){var a={};a.issue_key=e,a.release_version=r.data.release_version,a.rancher_app_version=r.data.rancher_app_version,a.config_file=r.data.config_file,t.form.selectList.push(a)}))},handle:function(e){window.open(e,"_blank")},handleSizeChange:function(e){this.currentPage=1,this.pageSize=e},handleCurrentChange:function(e){this.currentPage=e,this.listQuery.page=e,this.getList()},handleCreate:function(){var e=this;this.dialogUpdateEnable=!1,this.form.selectList=[],this.form.name=null,this.form.issueKey=null,this.form.project=null,this.form.category="正常发布",this.form.plan_release_time=null,Object(s["c"])().then((function(t){e.issueKeyOptions=t.data})),Object(i["e"])().then((function(t){e.projectOptions=t.data})),this.dialogFormVisible=!0,this.$nextTick((function(){e.$refs["form"].clearValidate()}))},showJiraVersion:function(e){this.jiraVersionDialogFormVisible=!0,this.jiraVersionList=e},openDetail:function(e){this.$router.push({path:"/releaseDetail",query:{name:e.name}})},isSelectTableListValid:function(){return 0!==this.form.selectList.length||(this.$message({message:"请选择至少一个发布工单",type:"error",duration:3e3}),!1)},submitForm:function(){var e=this;this.$refs["form"].validate((function(t){t&&e.isSelectTableListValid()&&(e.form.plan_release_time=f(e.form.plan_release_time).format("YYYY-MM-DD HH:mm:ss"),Object(i["a"])(e.form).then((function(t){e.dialogFormVisible=!1,e.$message({message:"创建成功",type:"success",duration:3e3}),e.getList()})))}))},handleDelete:function(e){var t=this;this.$confirm("确定删除？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){Object(i["b"])(e).then((function(e){t.$message({message:"删除成功",type:"success",duration:3e3}),t.getList()}))}))},deleteIssueKey:function(e,t){this.form.selectList.splice(this.form.selectList.findIndex((function(e){return e.issue_key===t.issue_key})),1)},handleEdit:function(e){var t=this;this.form=Object.assign({},e),this.dialogUpdateEnable=!0,this.form.selectList=e.release_contents,Object(s["c"])().then((function(e){t.issueKeyOptions=e.data})),Object(i["e"])().then((function(e){t.projectOptions=e.data})),this.dialogFormVisible=!0},updateForm:function(){var e=this;this.$refs["form"].validate((function(t){t&&(e.form.plan_release_time=f(e.form.plan_release_time).format("YYYY-MM-DD HH:mm:ss"),Object(i["g"])(e.form).then((function(t){e.dialogFormVisible=!1,e.$message({message:"更新成功",type:"success",duration:3e3}),e.getList()})))}))}}},d=p,m=(r("9bcf"),r("2877")),b=Object(m["a"])(d,a,l,!1,null,"c3861356",null);t["default"]=b.exports},5132:function(e,t,r){"use strict";r.d(t,"c",(function(){return l})),r.d(t,"d",(function(){return n})),r.d(t,"a",(function(){return s})),r.d(t,"b",(function(){return i}));var a=r("b775");function l(){return Object(a["a"])({url:"/jira/get_release_issue_key/",method:"get"})}function n(e){return Object(a["a"])({url:"/jira/get_release_issue_version/",method:"get",params:e})}function s(){return Object(a["a"])({url:"/jira/get_mdl_release_issue_key/",method:"get"})}function i(e){return Object(a["a"])({url:"/jira/get_mdl_release_issue_version/",method:"get",params:e})}},"8be9":function(e,t,r){"use strict";r.d(t,"a",(function(){return l})),r.d(t,"f",(function(){return n})),r.d(t,"d",(function(){return s})),r.d(t,"c",(function(){return i})),r.d(t,"e",(function(){return o})),r.d(t,"g",(function(){return c})),r.d(t,"b",(function(){return u}));var a=r("b775");function l(e){return Object(a["a"])({url:"/releasePlan/",method:"post",data:e})}function n(e){return Object(a["a"])({url:"/releasePlan/",method:"get",params:e})}function s(e){return Object(a["a"])({url:"/releasePlan/get_release_plan_options/",method:"get",params:e})}function i(e){return Object(a["a"])({url:"/releasePlan/get_release_plan_info/",method:"get",params:e})}function o(){return Object(a["a"])({url:"/releasePlan/get_release_plan_project/",method:"get"})}function c(e){return Object(a["a"])({url:"/releasePlan/update_release_plan/",method:"post",data:e})}function u(e){return Object(a["a"])({url:"/releasePlan/delete_release_plan/",method:"post",data:e})}},"9bcf":function(e,t,r){"use strict";r("a8b9")},a8b9:function(e,t,r){}}]);