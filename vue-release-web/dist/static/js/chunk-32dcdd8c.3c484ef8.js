(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-32dcdd8c"],{"2ca0":function(e,t,a){"use strict";var r=a("23e7"),s=a("06cf").f,l=a("50c4"),n=a("5a34"),i=a("1d80"),o=a("ab13"),c=a("c430"),u="".startsWith,f=Math.min,d=o("startsWith"),p=!c&&!d&&!!function(){var e=s(String.prototype,"startsWith");return e&&!e.writable}();r({target:"String",proto:!0,forced:!p&&!d},{startsWith:function(e){var t=String(i(this));n(e);var a=l(f(arguments.length>1?arguments[1]:void 0,t.length)),r=String(e);return u?u.call(t,r,a):t.slice(a,a+r.length)===r}})},5132:function(e,t,a){"use strict";a.d(t,"c",(function(){return s})),a.d(t,"d",(function(){return l})),a.d(t,"a",(function(){return n})),a.d(t,"b",(function(){return i}));var r=a("b775");function s(){return Object(r["a"])({url:"/jira/get_release_issue_key/",method:"get"})}function l(e){return Object(r["a"])({url:"/jira/get_release_issue_version/",method:"get",params:e})}function n(){return Object(r["a"])({url:"/jira/get_mdl_release_issue_key/",method:"get"})}function i(e){return Object(r["a"])({url:"/jira/get_mdl_release_issue_version/",method:"get",params:e})}},"5cec":function(e,t,a){},"8be9":function(e,t,a){"use strict";a.d(t,"a",(function(){return s})),a.d(t,"f",(function(){return l})),a.d(t,"d",(function(){return n})),a.d(t,"c",(function(){return i})),a.d(t,"e",(function(){return o})),a.d(t,"g",(function(){return c})),a.d(t,"b",(function(){return u}));var r=a("b775");function s(e){return Object(r["a"])({url:"/releasePlan/",method:"post",data:e})}function l(e){return Object(r["a"])({url:"/releasePlan/",method:"get",params:e})}function n(e){return Object(r["a"])({url:"/releasePlan/get_release_plan_options/",method:"get",params:e})}function i(e){return Object(r["a"])({url:"/releasePlan/get_release_plan_info/",method:"get",params:e})}function o(){return Object(r["a"])({url:"/releasePlan/get_release_plan_project/",method:"get"})}function c(e){return Object(r["a"])({url:"/releasePlan/update_release_plan/",method:"post",data:e})}function u(e){return Object(r["a"])({url:"/releasePlan/delete_release_plan/",method:"post",data:e})}},ba8c:function(e,t,a){"use strict";a("5cec")},ccab:function(e,t,a){"use strict";a.r(t);var r=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"app-container"},[a("el-card",{staticClass:"operate-container",attrs:{shadow:"never"}},[a("div",{staticClass:"block"},[a("el-row",{staticClass:"row-bg",attrs:{type:"flex",justify:"end"}},[a("el-col",{attrs:{span:3}},[a("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:"状态",clearable:"",filterable:""},on:{change:function(t){return e.filterSelectTrigger()}},model:{value:e.listQuery.optionValue.status,callback:function(t){e.$set(e.listQuery.optionValue,"status",t)},expression:"listQuery.optionValue.status"}},e._l(e.statusOptions,(function(e){return a("el-option",{key:e,attrs:{label:e,value:e}})})),1)],1),a("el-col",{attrs:{span:3}},[a("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:"创建人",clearable:"",filterable:""},on:{change:function(t){return e.filterSelectTrigger()}},model:{value:e.listQuery.optionValue.owner,callback:function(t){e.$set(e.listQuery.optionValue,"owner",t)},expression:"listQuery.optionValue.owner"}},e._l(e.ownerOptions,(function(e){return a("el-option",{key:e,attrs:{label:e,value:e}})})),1)],1),a("el-col",{attrs:{span:6}},[a("div",{staticClass:"grid-content bg-purple"},[a("el-input",{staticStyle:{width:"250px"},attrs:{placeholder:"搜索"},on:{change:function(t){return e.search()}},model:{value:e.listQuery.search,callback:function(t){e.$set(e.listQuery,"search",t)},expression:"listQuery.search"}})],1)]),a("el-col",{attrs:{span:10}},[a("div",{staticClass:"grid-content bg-purple-light"})]),a("el-col",{attrs:{span:2}},[a("div",{staticClass:"grid-content bg-purple"},[a("el-button",{attrs:{type:"primary",icon:"el-icon-edit"},on:{click:function(t){return e.handleCreate()}}},[e._v("创建")])],1)])],1)],1)]),a("el-table",{staticStyle:{width:"100%"},attrs:{data:e.list,"header-cell-style":{background:"#eef1f6",color:"#606266"}}},[a("el-table-column",{attrs:{label:"发布名称",sortable:""},scopedSlots:e._u([{key:"default",fn:function(t){var r=t.row;return[a("span",{staticClass:"link-type",on:{click:function(t){return e.openDetail(r)}}},[e._v(e._s(r.name))])]}}])}),a("el-table-column",{attrs:{label:"类型",sortable:""},scopedSlots:e._u([{key:"default",fn:function(t){var r=t.row;return["config"===r.type?a("span",[e._v("配置变更")]):e._e(),"version"===r.type?a("span",[e._v("版本发布")]):e._e()]}}])}),a("el-table-column",{attrs:{label:"创建时间",sortable:""},scopedSlots:e._u([{key:"default",fn:function(t){var a=t.row;return[e._v(" "+e._s(e._f("formatDate")(a.created_time))+" ")]}}])}),a("el-table-column",{attrs:{label:"计划发布时间",sortable:""},scopedSlots:e._u([{key:"default",fn:function(t){var a=t.row;return[e._v(" "+e._s(e._f("formatDate")(a.plan_release_time))+" ")]}}])}),a("el-table-column",{attrs:{label:"实际发布时间",sortable:""},scopedSlots:e._u([{key:"default",fn:function(t){var a=t.row;return[e._v(" "+e._s(e._f("formatDate")(a.release_time))+" ")]}}])}),a("el-table-column",{attrs:{label:"发布时长",sortable:""},scopedSlots:e._u([{key:"default",fn:function(t){var r=t.row;return[r.release_time?a("span",[e._v(e._s(e._f("duration")(r.release_time,r.last_updated_time)))]):e._e()]}}])}),a("el-table-column",{attrs:{prop:"owner",label:"创建人",sortable:""}}),a("el-table-column",{attrs:{label:"状态"},scopedSlots:e._u([{key:"default",fn:function(t){var r=t.row;return["发布成功"===r.status?a("el-tag",{attrs:{type:"success"}},[e._v(e._s(r.status))]):"发布失败"===r.status?a("el-tag",{attrs:{type:"danger"}},[e._v(e._s(r.status))]):a("el-tag",[e._v(e._s(r.status))])]}}])}),a("el-table-column",{attrs:{label:"发布对象"},scopedSlots:e._u([{key:"default",fn:function(t){var r=t.row;return[a("span",{staticClass:"link-type",on:{click:function(t){return e.showReleaseObject(r.release_contents)}}},[e._v("详情")])]}}])}),a("el-table-column",{attrs:{label:"操作",width:"250px"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-button",{attrs:{type:"success",size:"mini"},on:{click:function(a){return e.openDetail(t.row)}}},[e._v("发布入口 ")]),a("el-button",{attrs:{disabled:t.row.owner!==e.name||"发布成功"===t.row.status,type:"primary",size:"mini"},on:{click:function(a){return e.handleEdit(t.row)}}},[e._v("编辑 ")]),a("el-button",{attrs:{disabled:t.row.owner!==e.name||"未发布"!==t.row.status,type:"danger",size:"mini"},on:{click:function(a){return e.handleDelete(t.row)}}},[e._v("删除 ")])]}}])})],1),a("div",{staticClass:"pagination-container"},[a("el-pagination",{attrs:{align:"center","current-page":e.currentPage,"page-sizes":[10,15,20],"page-size":e.pageSize,layout:"total, sizes, prev, pager, next, jumper",total:e.total},on:{"size-change":e.handleSizeChange,"current-change":e.handleCurrentChange}})],1),a("el-dialog",{attrs:{title:"编辑发布计划",visible:e.dialogFormVisible,width:"60%","close-on-click-modal":!1},on:{"update:visible":function(t){e.dialogFormVisible=t}}},[a("el-form",{ref:"form",attrs:{model:e.form,rules:e.rules,"label-width":"110px"}},[a("el-form-item",{attrs:{label:"发布名称",prop:"name",required:""}},[a("el-input",{staticClass:"form-width",model:{value:e.form.name,callback:function(t){e.$set(e.form,"name",t)},expression:"form.name"}})],1),a("el-form-item",{attrs:{label:"计划发布时间",prop:"plan_release_time",required:""}},[a("el-date-picker",{staticClass:"form-width",attrs:{type:"datetime",placeholder:"选择计划发布时间"},model:{value:e.form.plan_release_time,callback:function(t){e.$set(e.form,"plan_release_time",t)},expression:"form.plan_release_time"}})],1),a("el-form-item",{attrs:{label:"类型",required:""}},[a("el-radio-group",{on:{change:function(t){return e.radioChange()}},model:{value:e.form.type,callback:function(t){e.$set(e.form,"type",t)},expression:"form.type"}},[a("el-radio",{attrs:{label:"version"}},[e._v("版本发布")]),a("el-radio",{attrs:{label:"config"}},[e._v("仅配置更新")])],1)],1),"version"===e.form.type?a("el-form-item",{attrs:{label:"Jira单号",required:""}},[a("el-select",{staticClass:"form-width",attrs:{filterable:"",clearable:"",placeholder:"请选择发布申请类型工单"},on:{change:function(t){return e.jiraSelectTrigger(e.form.issue_key)}},model:{value:e.form.issue_key,callback:function(t){e.$set(e.form,"issue_key",t)},expression:"form.issue_key"}},e._l(e.issueKeyOptions,(function(e){return a("el-option",{key:e,attrs:{label:e,value:e}})})),1)],1):e._e(),a("el-form-item",{attrs:{label:"发布对象",prop:"release_object"}},[a("el-select",{staticClass:"form-width",attrs:{filterable:"",clearable:"",placeholder:"服务器+IP+服务名"},on:{change:function(t){return e.selectTrigger(e.form.release_object)}},model:{value:e.form.release_object,callback:function(t){e.$set(e.form,"release_object",t)},expression:"form.release_object"}},e._l(e.releaseObjectOptions,(function(e){return a("el-option",{key:e,attrs:{label:e,value:e}})})),1),a("el-link",{attrs:{href:e.mdlLabelUrl,target:"_blank"}},[a("el-button",{staticStyle:{"margin-left":"10px"},attrs:{icon:"el-icon-edit",circle:""}})],1),a("el-table-draggable",[a("el-table",{staticStyle:{width:"100%"},attrs:{data:e.form.selectList,"row-key":"index"}},[a("el-table-column",{attrs:{type:"index",label:"发布顺序",width:"80px"}}),"version"===e.form.type?a("el-table-column",{attrs:{prop:"release_version",label:"发布版本"}}):e._e(),a("el-table-column",{attrs:{prop:"release_object",label:"发布对象"}}),a("el-table-column",{attrs:{label:"操作",width:"120px"},scopedSlots:e._u([{key:"default",fn:function(t){var r=t.row;return[a("el-button",{attrs:{type:"warning",size:"mini",icon:"el-icon-delete",circle:""},on:{click:function(t){return e.deleteServer(r)}}})]}}])},[e._v("> ")])],1)],1)],1)],1),a("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:function(t){e.dialogFormVisible=!1}}},[e._v("取 消")]),e.dialogUpdateEnable?a("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.updateForm()}}},[e._v("确 定")]):a("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.submitForm()}}},[e._v("确 定")])],1)],1),a("el-dialog",{attrs:{title:"mdl发布对象",visible:e.releaseObjectDialogFormVisible,width:"35%"},on:{"update:visible":function(t){e.releaseObjectDialogFormVisible=t}}},[a("el-table",{staticStyle:{width:"100%"},attrs:{data:e.releaseObjectList}},[a("el-table-column",{attrs:{prop:"index",label:"发布顺序",width:"80px"}}),a("el-table-column",{attrs:{label:"jira工单"},scopedSlots:e._u([{key:"default",fn:function(t){var r=t.row;return[a("el-link",{attrs:{href:"https://jira.datayes.com/browse/"+r.issue_key,type:"success",target:"_blank"}},[e._v(" "+e._s(r.issue_key)+" ")])]}}])}),a("el-table-column",{attrs:{prop:"release_object",label:"发布对象"}}),a("el-table-column",{attrs:{prop:"release_version",label:"发布版本"}})],1)],1)],1)},s=[],l=a("5530"),n=(a("d3b7"),a("6062"),a("3ca3"),a("ddb0"),a("159b"),a("ac1f"),a("841c"),a("498a"),a("caad"),a("2ca0"),a("b0c0"),a("a434"),a("c740"),a("d81d"),a("5132")),i=a("8be9"),o=a("e4a4"),c=a.n(o),u=a("2f62"),f=a("b775");function d(){return Object(f["a"])({url:"/cmdb/get_mdl_release_server/",method:"get"})}var p=a("c1df"),b={name:"Index",filters:{duration:function(e,t){var r=a("c1df"),s=r(t),l=r(e);return s.diff(l,"hours")+"h"+s.diff(l,"minutes")%60+"m"+s.diff(l,"seconds")%60+"s"}},components:{ElTableDraggable:c.a},data:function(){return{optionValue:{},statusOptions:new Set,ownerOptions:new Set,list:[],total:null,listLoading:!0,currentPage:1,pageSize:10,listQuery:{page:1,type:"MDL",search:null,optionValue:{status:"",owner:""}},form:{selectList:[],name:"",project:"MDL",type:"version",plan_release_time:"",issue_key:"",release_object:""},releaseObjectOptions:[],projectOptions:[],parentId:0,value1:null,num:5,dialogFormVisible:!1,dialogUpdateEnable:!1,issueKeyOptions:[],releaseObjectDialogFormVisible:!1,releaseObjectList:[],releaseObjectType:"",dialogServerFormVisible:!1,labelToServer:{},mdlLabelUrl:window.config.MDL_LABEL_URL}},computed:Object(l["a"])({},Object(u["b"])(["name"])),created:function(){this.getList(),this.getReleasePlanOptions()},methods:{dateFormat:function(e,t){var a=e[t.property];return p(a).format("YYYY-MM-DD HH:mm:ss")},getList:function(){var e=this;this.listLoading=!0,Object(i["f"])(this.listQuery).then((function(t){e.listLoading=!1;var a=t.data.results;e.total=t.data.count,e.list=[],a.forEach((function(t){t.type=t.release_contents[0].type,e.list.push(t)}))}))},getReleasePlanOptions:function(){var e=this;Object(i["d"])({type:"MDL"}).then((function(t){var a=t.data;e.statusOptions=a.status,e.ownerOptions=a.owner}))},filterSelectTrigger:function(){this.listQuery.page=1,this.getList()},search:function(){this.listQuery.search&&(this.listQuery.search=this.listQuery.search.trim()),this.getList()},selectTrigger:function(e){var t=this,a=[];if(this.form.selectList.forEach((function(e){a.push(e.release_object)})),e&&!a.includes(e)){var r=[];e.startsWith("label_")?r=this.labelToServer[e]:r.push(e),"version"===this.form.type?Object(n["b"])({issue_key:this.form.issue_key}).then((function(e){r.forEach((function(a){var r={};r.release_version=e.data,r.release_object=a,r.config_file="",t.form.selectList.push(r)}))})):"config"===this.form.type&&r.forEach((function(e){var a={};a.release_object=e,a.config_file="",t.form.selectList.push(a)}))}},handle:function(e){window.open(e,"_blank")},handleSizeChange:function(e){this.currentPage=1,this.pageSize=e},handleCurrentChange:function(e){this.currentPage=e,this.listQuery.page=e,this.getList()},handleCreate:function(){var e=this;this.dialogUpdateEnable=!1,this.form.selectList=[],this.form.name="",this.form.issue_key="",this.form.plan_release_time="",this.form.release_object="",this.form.type="version",Object(n["a"])().then((function(t){e.issueKeyOptions=t.data})),d().then((function(t){e.releaseObjectOptions=t.data.release_object,e.labelToServer=t.data.label_to_server})),this.dialogFormVisible=!0,this.$nextTick((function(){e.$refs["form"].clearValidate()}))},openDetail:function(e){this.$router.push({path:"/releaseDetail",query:{name:e.name}})},isSelectTableListValid:function(){return 0!==this.form.selectList.length||(this.$message({message:"请选择至少一个发布对象",type:"error",duration:3e3}),!1)},submitForm:function(){var e=this;this.$refs["form"].validate((function(t){t&&e.isSelectTableListValid()&&(e.form.plan_release_time=p(e.form.plan_release_time).format("YYYY-MM-DD HH:mm:ss"),Object(i["a"])(e.form).then((function(t){e.dialogFormVisible=!1,e.$message({message:"创建成功",type:"success",duration:3e3}),e.getList()})))}))},handleDelete:function(e){var t=this;this.$confirm("确定删除？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){Object(i["b"])(e).then((function(e){t.$message({message:"删除成功",type:"success",duration:3e3}),t.getList()}))}))},deleteServer:function(e){this.form.selectList.splice(this.form.selectList.findIndex((function(t){return t.release_object===e.release_object})),1)},handleEdit:function(e){var t=this;this.form=Object.assign({},e),this.dialogUpdateEnable=!0,this.form.type=e.release_contents[0].type,this.form.issue_key=e.release_contents[0].issue_key,this.form.selectList=e.release_contents.map((function(e){return t.$set(e,"edit",!1),e})),Object(n["a"])().then((function(e){t.issueKeyOptions=e.data})),d().then((function(e){t.releaseObjectOptions=e.data.release_object,t.labelToServer=e.data.label_to_server})),this.dialogFormVisible=!0},handleReleaseServerCreate:function(){this.dialogServerFormVisible=!0},updateForm:function(){var e=this;this.$refs["form"].validate((function(t){t&&e.isSelectTableListValid()&&(e.form.plan_release_time=p(e.form.plan_release_time).format("YYYY-MM-DD HH:mm:ss"),Object(i["g"])(e.form).then((function(t){e.dialogFormVisible=!1,e.$message({message:"更新成功",type:"success",duration:3e3}),e.getList()})))}))},jiraSelectTrigger:function(){this.$forceUpdate()},radioChange:function(){this.$forceUpdate()},showReleaseObject:function(e){this.releaseObjectDialogFormVisible=!0,this.releaseObjectList=e}}},m=b,h=(a("ba8c"),a("2877")),_=Object(h["a"])(m,r,s,!1,null,"f5e36bf2",null);t["default"]=_.exports}}]);