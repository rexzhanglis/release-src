(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-e7ec57ba"],{"019e":function(e,t,a){},"1d3e":function(e,t,a){"use strict";a.r(t);var s=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"app-container"},[a("el-card",[a("el-descriptions",{staticStyle:{"font-size":"large"},attrs:{title:"任务信息"}},[a("el-descriptions-item",{attrs:{label:"名称"}},[e._v(e._s(e.taskDetail.name))]),a("el-descriptions-item",{attrs:{label:"创建时间"}},[e._v(e._s(e._f("formatDate")(e.taskDetail.created_time)))]),a("el-descriptions-item",{attrs:{label:"计划发布时间"}},[e._v(e._s(e._f("formatDate")(e.taskDetail.plan_release_time)))]),a("el-descriptions-item",{attrs:{label:"创建用户"}},[e._v(e._s(e.taskDetail.owner))])],1),a("el-descriptions",{staticStyle:{"font-size":"large","margin-top":"1%"},attrs:{title:"执行信息"}},[a("el-descriptions-item",{attrs:{label:"执行用户"}},[e._v(e._s(e.releaseDetail.user))]),a("el-descriptions-item",{attrs:{label:"开始时间"}},[e.releaseDetail.created_time?a("span",[e._v(e._s(e._f("formatDate")(e.releaseDetail.created_time)))]):e._e()]),a("el-descriptions-item",{attrs:{label:"任务耗时"}},[e.releaseDetail.created_time?a("span",[e._v(e._s(e._f("duration")(e.releaseDetail.created_time,e.releaseDetail.last_updated_time)))]):e._e()]),a("el-descriptions-item",{attrs:{label:"任务状态"}},["发布失败"===e.releaseDetail.status?a("span",{staticStyle:{color:"orangered"}},[e._v(e._s(e.releaseDetail.status))]):a("span",{staticStyle:{color:"#67C23A"}},[e._v(e._s(e.releaseDetail.status))])]),a("el-descriptions-item",{attrs:{label:"流程提示"}},[e._v(e._s(e.releaseDetail.prompt))])],1)],1),a("el-card",[a("el-collapse",{staticClass:"el-collapse-item__Bos",model:{value:e.activeNames,callback:function(t){e.activeNames=t},expression:"activeNames"}},[a("el-collapse-item",{attrs:{name:"1"}},[a("span",{staticClass:"collapse-title",attrs:{slot:"title"},slot:"title"},[e._v("流程图")]),e.editVisible()?a("el-row",{staticStyle:{"margin-top":"1%"}},[a("el-col",{attrs:{span:12}},["发布"===e.release_button?a("el-button",{attrs:{disabled:!e.isRelease,type:"success"},on:{click:function(t){return e.deploy()}}},[e._v("发布 ")]):e._e(),"暂停"===e.release_button?a("el-button",{attrs:{disabled:!e.isRelease,type:"warning"},on:{click:function(t){return e.suspend()}}},[e._v("暂停 ")]):e._e(),"再发布"===e.release_button?a("el-button",{attrs:{disabled:!e.isRelease,type:"success"},on:{click:function(t){return e.reDeploy()}}},[e._v("再发布 ")]):e._e(),a("el-button",{attrs:{disabled:!e.isRollback,type:"info"},on:{click:function(t){return e.rollback()}}},[e._v("回滚")]),a("el-button",{attrs:{disabled:!e.isFail,type:"warning"},on:{click:function(t){return e.failSkip()}}},[e._v("失败跳过")]),a("el-button",{attrs:{disabled:!e.isFail,type:"primary"},on:{click:function(t){return e.failRetry()}}},[e._v("失败重试")])],1)],1):e._e(),"MDL"===this.taskDetail.project?a("el-steps",{staticStyle:{"margin-top":"1.5%"},attrs:{space:250,"align-center":"",active:e.releaseDetail.active-1,"process-status":e.processStatus}},e._l(e.moduleList,(function(e){return a("el-step",{attrs:{title:e.release_object,description:e.release_version,status:e.status}})})),1):a("el-steps",{staticStyle:{"margin-top":"1.5%"},attrs:{space:250,"align-center":"",active:e.releaseDetail.active-1,"process-status":e.processStatus}},e._l(e.moduleList,(function(e){return a("el-step",{attrs:{title:e.release_version,status:e.status}})})),1)],1),a("el-collapse-item",{attrs:{name:"2"}},[a("span",{staticClass:"collapse-title",attrs:{slot:"title"},slot:"title"},[e._v("日志")]),e._l(e.log,(function(t){return a("div",[e._v(e._s(t))])}))],2)],1)],1)],1)},n=[],l=a("1da1"),i=a("5530"),r=(a("96cf"),a("b0c0"),a("159b"),a("ac1f"),a("1276"),a("d3b7"),a("b775"));function o(e){return Object(r["a"])({url:"/releaseDetail/get_release_detail_info/",method:"get",params:e})}function c(e){return Object(r["a"])({url:"/releaseDetail/deploy/",method:"post",data:e})}function u(e){return Object(r["a"])({url:"/releaseDetail/suspend/",method:"post",data:e})}function f(e){return Object(r["a"])({url:"/releaseDetail/re_deploy/",method:"post",data:e})}function m(e){return Object(r["a"])({url:"/releaseDetail/rollback/",method:"post",data:e})}function d(e){return Object(r["a"])({url:"/releaseDetail/fail_skip/",method:"post",data:e})}function p(e){return Object(r["a"])({url:"/releaseDetail/fail_retry/",method:"post",data:e})}var _=a("8be9"),b=a("5c96"),h=a("2f62"),v=a("5f87"),D={name:"ReleaseDetail",filters:{duration:function(e,t){var s=a("c1df"),n=s(t),l=s(e);return n.diff(l,"hours")+"h"+n.diff(l,"minutes")%60+"m"+n.diff(l,"seconds")%60+"s"}},computed:Object(i["a"])({},Object(h["b"])(["name"])),data:function(){return{moduleList:[],list:null,fullList:null,total:null,listLoading:!0,releasePlanName:null,taskDetail:null,isFail:!1,isRollback:!1,isRelease:!0,releaseDetail:{user:null,created_time:null,last_updated_time:null,status:null,prompt:null},log:[],release_button:"发布",processStatus:"process",activeNames:["1"]}},created:function(){this.releasePlanName=this.$route.query.name,this.getReleasePlanInfo()},beforeDestroy:function(){clearInterval(this.timer)},methods:{handle:function(e){window.open(e,"_blank")},editVisible:function(){return("发布成功"!==this.releaseDetail.status||!this.isMoreThanWeek())&&(!!Object(v["b"])("devops")||!!Object(v["b"])("admin"))},isMoreThanWeek:function(){var e=new Date(this.releaseDetail.last_updated_time).getTime()+6048e5;return e<new Date},getReleasePlanInfo:function(){var e=this;Object(_["c"])({name:this.releasePlanName}).then((function(t){e.taskDetail=t.data,"MDL"===e.taskDetail.project?e.taskDetail.release_contents.forEach((function(t){e.moduleList.push({release_version:t.release_version,status:t.status,release_object:t.release_object})})):e.taskDetail.release_contents.forEach((function(t){e.moduleList.push({release_version:t.release_version,status:t.status})})),e.getReleaseDetailInfo()}))},getReleaseDetailInfo:function(){var e=this;o({name:this.releasePlanName}).then((function(t){if(t.data){e.releaseDetail=t.data,e.isRollback=!0,e.log=e.releaseDetail.log.split("\n");var a=[];e.releaseDetail.step_status.forEach((function(e){a.push({release_version:e.release_version,status:e.status,release_object:e.release_object})})),e.moduleList=a,"发布中"===e.releaseDetail.status?(e.release_button="暂停",e.isFail=!1,e.timer||e.startTimer()):"暂停"===e.releaseDetail.status?(e.release_button="再发布",e.isFail=!1):"发布失败"===e.releaseDetail.status?(e.isFail=!0,e.isRelease=!1):"发布成功"===e.releaseDetail.status?(e.isRelease=!1,e.isFail=!1,e.timer&&clearInterval(e.timer)):"回滚中"===e.releaseDetail.status?(e.isRelease=!1,e.isFail=!1,e.isRollback=!1,e.timer||e.startTimer()):"回滚成功"===e.releaseDetail.status?(e.isRelease=!0,e.release_button="发布",e.isFail=!1,e.isRollback=!1,e.timer&&clearInterval(e.timer)):"回滚失败"===e.releaseDetail.status&&(e.isRelease=!1,e.isFail=!0,e.isRollback=!1)}}))},sleep:function(e){return new Promise((function(t){setTimeout(t,e)}))},deploy:function(){var e=this;this.$confirm("确定升级？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){e.release_button="暂停",c({name:e.releasePlanName}).then((function(t){e.handleFail(t)})),e.startTimer()}))},suspend:function(){var e=this;this.$confirm("确定暂停？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){clearInterval(e.timer),e.release_button="再发布",u({name:e.releasePlanName}).then((function(t){e.$message({message:"暂停成功",type:"success",duration:3e3})})),e.suspendTimer()}))},reDeploy:function(){var e=this;this.$confirm("确定再发布？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){e.release_button="暂停",f({name:e.releasePlanName}).then((function(t){e.handleFail(t)})),e.startTimer()}))},rollback:function(){var e=this;this.$confirm("确定回滚？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){m({name:e.releasePlanName}).then((function(t){e.handleFail(t)})),e.startTimer()}))},failSkip:function(){var e=this;this.$confirm("确定失败跳过？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){d({name:e.releasePlanName}).then((function(t){e.handleFail(t)})),e.startTimer()}))},failRetry:function(){var e=this;this.$confirm("确定失败重试？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){p({name:e.releasePlanName}).then((function(t){e.handleFail(t)})),e.startTimer()}))},handleFail:function(e){clearInterval(this.timer),this.getReleaseDetailInfo(),"fail"===e.data&&Object(b["Message"])({message:e.message,type:"error",duration:5e3})},startTimer:function(){var e=this;return Object(l["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,e.sleep(500);case 2:e.getReleaseDetailInfo(),e.timer=setInterval(e.getReleaseDetailInfo,5e3);case 4:case"end":return t.stop()}}),t)})))()},suspendTimer:function(){var e=this;return Object(l["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,e.sleep(5e3);case 2:e.getReleaseDetailInfo();case 3:case"end":return t.stop()}}),t)})))()}}},g=D,k=(a("706f"),a("2877")),y=Object(k["a"])(g,s,n,!1,null,"05aac746",null);t["default"]=y.exports},"706f":function(e,t,a){"use strict";a("019e")},"8be9":function(e,t,a){"use strict";a.d(t,"a",(function(){return n})),a.d(t,"f",(function(){return l})),a.d(t,"d",(function(){return i})),a.d(t,"c",(function(){return r})),a.d(t,"e",(function(){return o})),a.d(t,"g",(function(){return c})),a.d(t,"b",(function(){return u}));var s=a("b775");function n(e){return Object(s["a"])({url:"/releasePlan/",method:"post",data:e})}function l(e){return Object(s["a"])({url:"/releasePlan/",method:"get",params:e})}function i(e){return Object(s["a"])({url:"/releasePlan/get_release_plan_options/",method:"get",params:e})}function r(e){return Object(s["a"])({url:"/releasePlan/get_release_plan_info/",method:"get",params:e})}function o(){return Object(s["a"])({url:"/releasePlan/get_release_plan_project/",method:"get"})}function c(e){return Object(s["a"])({url:"/releasePlan/update_release_plan/",method:"post",data:e})}function u(e){return Object(s["a"])({url:"/releasePlan/delete_release_plan/",method:"post",data:e})}}}]);